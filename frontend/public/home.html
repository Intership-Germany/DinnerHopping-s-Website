<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Dinnerhopping - Home</title>
	<script src="js/core/auth-guard.js"></script>
	<script src="https://cdn.tailwindcss.com"></script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
	<script src="js/config.js"></script>
	<script src="js/core/auth.js"></script>
	<script src="js/unauthorized.js"></script>
	<script src="js/core/client.js"></script>
	<script src="js/debug-banner.js"></script>
	<script src="js/core/includes.js" defer></script>
	<script src="js/utils/network-errors.js" defer></script>
	<script src="js/utils/dom.js" defer></script>
	<script src="js/utils/events.js" defer></script>
	<script src="js/utils/registration.js" defer></script>
	<script src="js/components/event-card.js" defer></script>
	<script src="js/components/register-modal.js" defer></script>
	<script src="js/components/my-registrations.js" defer></script>
	<script src="js/pages/home.js" defer></script>
	<style>
		body {
			font-family: 'Inter', sans-serif;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			background-color: #f0f4f7;
		}

		/* Sidebar scroll enhancement */
		#my-registrations-list {
			scrollbar-width: thin;
			scrollbar-color: #00808055 transparent;
		}

		/* Expanded event card spanning two columns on md+ screens */
		#events-list .dh-event-card.md\:col-span-2 { grid-column: span 2 / span 2; }
		.event-desc-wrapper { display:inline-block; max-width:100%; }
		.event-desc-wrapper.transition-all { transition: max-height 0.35s ease, padding 0.35s ease; }
		/* Multi-line clamp (3 lines) */
		.dh-line-clamp-3 { display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:3; line-clamp:3; overflow:hidden; }
		/* On wider screens allow meta to sit beside description if desired */
		@media (min-width:768px){ .dh-event-card .event-desc-wrapper { display:block; } }

		#my-registrations-list::-webkit-scrollbar {
			width: 6px;
		}

		#my-registrations-list::-webkit-scrollbar-track {
			background: transparent;
		}

		#my-registrations-list::-webkit-scrollbar-thumb {
			background: #00808055;
			border-radius: 4px;
		}

		#my-registrations-list::-webkit-scrollbar-thumb:hover {
			background: #00808088;
		}
	</style>
</head>

<body class="text-[#172a3a] min-h-screen flex flex-col">
	<!-- Header -->
	<div data-include="partials/header.html"></div>

		<!-- Main Content -->
		<main class="flex-grow max-w-6xl mx-auto w-full px-4 py-10">
			<h1 class="text-3xl font-bold mb-8 text-center lg:text-left">Upcoming & Active Events</h1>
			<div class="lg:grid lg:grid-cols-[1fr_320px] lg:gap-8 items-start">
				<!-- Left: filters + events -->
				<div class="space-y-6">
					<!-- Filters (events column only) -->
					<section class="bg-white/70 backdrop-blur rounded-xl shadow p-4">
						<form id="events-filters" class="grid grid-cols-1 md:grid-cols-7 gap-3 items-end">
							<label class="flex flex-col md:col-span-2">
								<span class="text-xs font-medium text-gray-600">Title</span>
								<input id="filter-title" type="text" placeholder="Search title..." class="mt-1 rounded-lg border-gray-300 focus:ring-[#008080] focus:border-[#008080]" />
							</label>
							<label class="flex flex-col">
								<span class="text-xs font-medium text-gray-600">Max fee</span>
								<select id="filter-fee" class="mt-1 rounded-lg border-gray-300 focus:ring-[#008080] focus:border-[#008080]">
									<option value="">Any</option>
									<option value="0">Free only</option>
									<option value="500">≤ 5 €</option>
									<option value="1000">≤ 10 €</option>
									<option value="2000">≤ 20 €</option>
								</select>
							</label>
							<label class="flex flex-col">
								<span class="text-xs font-medium text-gray-600">Deadline before</span>
								<input id="filter-deadline" type="date" class="mt-1 rounded-lg border-gray-300 focus:ring-[#008080] focus:border-[#008080]" />
							</label>
							<label class="flex items-center gap-2 md:justify-end">
								<input id="filter-available" type="checkbox" class="rounded text-[#008080] focus:ring-[#008080]" />
								<span class="text-sm text-gray-700">Only available</span>
							</label>
							<label class="flex flex-col">
								<span class="text-xs font-medium text-gray-600">Sort by</span>
								<select id="filter-sort" class="mt-1 rounded-lg border-gray-300 focus:ring-[#008080] focus:border-[#008080]">
									<option value="">Default</option>
									<option value="deadline_asc">Deadline · soonest</option>
									<option value="fee_asc">Fee · low to high</option>
									<option value="fee_desc">Fee · high to low</option>
								</select>
							</label>
							<div class="flex md:justify-end">
								<button type="reset" id="filter-reset" class="inline-flex items-center px-3 py-2 rounded-lg border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">Reset</button>
							</div>
						</form>
						<div class="mt-3 flex flex-wrap items-center gap-2">
							<div id="active-filters" class="flex flex-wrap gap-2"></div>
							<span id="results-count" class="text-sm text-gray-600"></span>
						</div>
					</section>
					<!-- Dynamic events list -->
					<div id="events-list" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
					<!-- Pagination -->
					<nav id="events-pager" class="mt-6 flex items-center justify-center gap-2" aria-label="Pagination">
						<button id="page-prev" class="px-3 py-2 rounded-lg border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">Prev</button>
						<span id="page-info" class="text-sm text-gray-700"></span>
						<button id="page-next" class="px-3 py-2 rounded-lg border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">Next</button>
					</nav>
				</div>
				<!-- Right: sidebar -->
				<aside id="my-registrations" class="hidden lg:block lg:mt-0 self-start">
					<div class="bg-[#008080]/10 border border-[#008080]/30 rounded-2xl p-5 lg:sticky lg:top-24 shadow-sm">
						<h2 class="text-lg font-semibold text-[#172a3a] mb-4 flex items-center gap-2 tracking-tight">
							<span class="w-2.5 h-2.5 rounded-full bg-[#008080] animate-pulse shadow"></span>
							My registrations
						</h2>
						<div id="my-registrations-list" class="space-y-4 max-h-[70vh] overflow-auto pr-1"></div>
					</div>
				</aside>
			</div>

			<!-- Provider chooser modal -->
			<template id="tpl-provider-modal">
				<div class="fixed inset-0 z-50 flex items-center justify-center">
					<div class="absolute inset-0 bg-black/40"></div>
					<div class="relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6">
						<div class="flex items-start justify-between mb-4">
							<h3 class="text-lg font-bold text-[#172a3a]">Choose a payment provider</h3>
							<button type="button" class="provider-close text-gray-500 hover:text-gray-700">✕</button>
						</div>
						<div class="space-y-3">
									<div class="providers-list space-y-2">
										<!-- Buttons will be injected here on page load based on /payments/providers -->
									</div>
						</div>
					</div>
				</div>
			</template>

							<script src="js/init/providers.js" defer></script>

		<!-- Templates: keep JS minimal and visuals consistent -->
		<template id="tpl-loading">
			<div class="bg-white rounded-2xl shadow-xl p-6 animate-pulse">
				<div class="h-6 bg-gray-200 rounded w-2/3 mb-4"></div>
				<div class="h-4 bg-gray-100 rounded w-1/3 mb-2"></div>
				<div class="h-4 bg-gray-100 rounded w-full"></div>
			</div>
		</template>

		<template id="tpl-error">
			<div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded">Could not load events. Please try
				again later.</div>
		</template>

		<template id="tpl-empty">
			<div class="bg-white rounded-2xl shadow p-6 text-center text-gray-600">No published events at the moment.
				Please check back soon!</div>
		</template>

		<template id="tpl-event-card">
				<div
					class="dh-event-card bg-white rounded-2xl shadow-xl p-6 flex flex-col md:flex-row md:gap-4 items-start md:items-center border-l-4 border-[#008080] transition-all duration-300">
					<div class="event-left text-left w-full md:flex-1 md:min-w-0 md:pr-2">
					<h2 class="event-title text-xl font-bold mb-2 text-[#008080]"></h2>
					<p class="event-desc text-sm text-gray-700 mb-2"></p>
					<div class="event-meta flex flex-wrap gap-2 w-fit">
						<span
							class="event-date inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-[#008080]/10 text-[#005f5f] ring-1 ring-[#008080]/20">
							<svg xmlns="https://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
								class="w-3.5 h-3.5">
								<path
									d="M6 2a1 1 0 011 1v1h6V3a1 1 0 112 0v1h1a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2h1V3a1 1 0 011-1zM4 8v7a1 1 0 001 1h10a1 1 0 001-1V8H4z" />
							</svg>
							<span class="event-date-text"></span>
						</span>
						<span
							class="event-fee-badge inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700 ring-1 ring-gray-200">
							<svg xmlns="https://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
								class="w-3.5 h-3.5">
								<path
									d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.5a.75.75 0 10-1.5 0v.32a3.751 3.751 0 00-2.69 1.67.75.75 0 101.28.8 2.251 2.251 0 011.41-.98v2.37a3.251 3.251 0 00-2.75 3.21 3.25 3.25 0 006.5 0 .75.75 0 10-1.5 0 1.75 1.75 0 11-3.5 0c0-.8.55-1.48 1.25-1.69v2.19a.75.75 0 101.5 0v-2.2a3.251 3.251 0 002.75-3.19 3.25 3.25 0 00-3-3.2V6.5z" />
							</svg>
							<span class="event-fee-text"></span>
						</span>
						<span
							class="event-zip-badge hidden inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700 ring-1 ring-gray-200">
							<svg xmlns="https://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
								class="w-3.5 h-3.5">
								<path
									d="M10 18a8 8 0 100-16 8 8 0 000 16zM7.25 9A.75.75 0 017 7.5h6a.75.75 0 010 1.5H7.25z" />
							</svg>
							<span class="event-zip-text">Out of your ZIP area</span>
						</span>
					</div>
				</div>
					<div class="event-right flex flex-col items-center md:items-end gap-2 mt-4 md:mt-0 w-full md:w-auto md:ml-2 md:flex-shrink-0">
					<span class="event-spots text-sm font-semibold"></span>
					<a class="event-cta px-6 py-3 bg-[#008080] text-white font-bold rounded-xl shadow-lg transition-transform duration-300 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-[#008080]/40"
						href="#">Apply Now</a>
				</div>
			</div>
		</template>

		<!-- Registration Modal (Solo/Team) -->
		<template id="tpl-register-modal">
			<div class="fixed inset-0 z-50 flex items-center justify-center">
				<div class="absolute inset-0 bg-black/40"></div>
				<div class="relative bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 p-6">
					<div class="flex items-start justify-between mb-3">
						<h3 class="text-lg font-bold text-[#172a3a]">Register for event</h3>
						<button type="button" class="reg-close text-gray-500 hover:text-gray-700">✕</button>
					</div>
					<div class="mb-3">
						<div class="inline-flex bg-gray-100 rounded-lg p-1">
							<button
								class="tab-btn solo px-3 py-1.5 rounded-md bg-white text-[#172a3a] font-semibold">Solo</button>
							<button class="tab-btn team px-3 py-1.5 rounded-md text-gray-600">Team</button>
						</div>
					</div>
					<form class="reg-form space-y-3" data-mode="solo">
						<!-- Shared hidden state -->
						<input type="hidden" name="event_id" />
						<!-- Solo form -->
						<div class="form-solo space-y-3">
							<label class="flex flex-col">
								<span class="text-xs font-medium text-gray-600">Dietary preference</span>
								<select name="dietary" class="mt-1 rounded-lg border-gray-300">
									<option value="">Use profile default</option>
									<option value="vegan">Vegan</option>
									<option value="vegetarian">Vegetarian</option>
									<option value="omnivore">Omnivore</option>
								</select>
							</label>
							<div class="grid grid-cols-2 gap-3">
								<label class="flex flex-col">
									<span class="text-xs font-medium text-gray-600">Kitchen available?</span>
									<select name="kitchen" class="mt-1 rounded-lg border-gray-300">
										<option value="">Use profile default</option>
										<option value="yes">Yes</option>
										<option value="no">No</option>
									</select>
								</label>
								<label class="flex flex-col">
									<span class="text-xs font-medium text-gray-600">Main course possible?</span>
									<select name="main_course" class="mt-1 rounded-lg border-gray-300">
										<option value="">Use profile default</option>
										<option value="yes">Yes</option>
										<option value="no">No</option>
									</select>
								</label>
							</div>
							<label class="flex flex-col">
								<span class="text-xs font-medium text-gray-600">Course preference</span>
								<select name="course" class="mt-1 rounded-lg border-gray-300">
									<option value="">No preference</option>
									<option value="starter">Starter</option>
									<option value="main">Main</option>
									<option value="dessert">Dessert</option>
								</select>
								<small class="text-[11px] text-gray-500">Main can be selected only if main course is
									possible.</small>
							</label>
						</div>
						<!-- Team form -->
						<div class="form-team hidden space-y-3">
							<div class="rounded-lg border p-3">
								<label class="flex items-center gap-2 text-sm"><input type="radio" name="partner_mode"
										value="existing" checked> Invite existing user</label>
								<label class="flex items-center gap-2 text-sm mt-1"><input type="radio"
										name="partner_mode" value="external"> Add external partner</label>
								<div class="mt-2 partner-existing">
									<input type="email" name="partner_email" placeholder="Partner email"
										class="w-full rounded-lg border-gray-300" />
								</div>
								<div class="mt-2 partner-external hidden grid grid-cols-2 gap-2">
									<input type="text" name="partner_name" placeholder="Partner name"
										class="rounded-lg border-gray-300" />
									<input type="email" name="partner_email_ext" placeholder="Partner email"
										class="rounded-lg border-gray-300" />
									<select name="partner_gender" class="rounded-lg border-gray-300">
										<option value="">Gender</option>
										<option value="female">Female</option>
										<option value="male">Male</option>
										<option value="diverse">Diverse</option>
										<option value="prefer_not_to_say">Prefer not to say</option>
									</select>
									<select name="partner_dietary" class="rounded-lg border-gray-300">
										<option value="">Dietary</option>
										<option value="vegan">Vegan</option>
										<option value="vegetarian">Vegetarian</option>
										<option value="omnivore">Omnivore</option>
									</select>
									<input type="text" name="partner_field" placeholder="Field of study"
										class="rounded-lg border-gray-300" />
								</div>
							</div>
							<div class="grid grid-cols-2 gap-3">
								<label class="flex flex-col">
									<span class="text-xs font-medium text-gray-600">Cooking location</span>
									<select name="cook_location" class="mt-1 rounded-lg border-gray-300">
										<option value="self">My address</option>
										<option value="partner">Partner's address</option>
									</select>
									<small class="text-[11px] text-gray-500">At least one of you must have a kitchen
										available.</small>
								</label>
								<label class="flex flex-col">
									<span class="text-xs font-medium text-gray-600">Team course preference</span>
									<select name="team_course" class="mt-1 rounded-lg border-gray-300">
										<option value="">No preference</option>
										<option value="starter">Starter</option>
										<option value="main">Main</option>
										<option value="dessert">Dessert</option>
									</select>
								</label>
							</div>
							<div class="text-xs text-gray-600" id="team-diet-summary"></div>
						</div>
						<div class="flex justify-end gap-2 pt-2">
							<button type="button"
								class="reg-cancel px-3 py-2 rounded-lg border border-gray-300 text-sm">Cancel</button>
							<button type="submit"
								class="reg-submit px-4 py-2 rounded-lg bg-[#008080] text-white font-semibold">Continue</button>
						</div>
						<p class="text-[11px] text-gray-500 mt-1">You’ll be redirected to payment if a fee is required.
						</p>
					</form>
				</div>
			</div>
		</template>

			<!-- My registration card template -->
		<template id="tpl-myreg-card">
			<div
				class="bg-white/95 backdrop-blur-sm rounded-xl shadow-sm ring-1 ring-[#008080]/15 p-4 flex flex-col gap-2 text-sm leading-snug">
				<div class="flex items-start justify-between gap-3">
					<div class="min-w-0 space-y-1">
						<div class="flex flex-wrap items-center gap-2">
							<h3 class="reg-title font-semibold text-[#006666] truncate max-w-[140px]"></h3>
							<span
								class="reg-badge inline-flex items-center gap-1 px-2 py-0.5 text-[11px] font-medium rounded-full bg-gray-100 text-gray-700 ring-1 ring-gray-200"></span>
						</div>
						<p class="reg-match text-[11px] text-gray-600"></p>
						<p class="reg-date text-[11px] text-gray-600"></p>
						<p class="reg-note text-[11px] text-red-600 mt-1 hidden"></p>
						<p class="reg-payment-id text-[11px] text-gray-700 mt-1 hidden"></p>
						<p class="reg-prefs text-[11px] text-gray-600 mt-1"></p>
					</div>
					<div class="flex flex-col items-end gap-1 shrink-0">
						<button
							class="reg-pay hidden px-2.5 py-1.5 rounded-md bg-[#008080] text-white text-[11px] font-medium shadow hover:bg-[#006d6d]">Pay
						now</button>
						<button
							class="reg-accept hidden px-2.5 py-1.5 rounded-md bg-blue-600 text-white text-[11px] font-medium shadow hover:bg-blue-700">Accept
						</button>
						<button
							class="reg-show-id hidden px-2.5 py-1.5 rounded-md border border-gray-300 text-[11px] hover:bg-gray-50">Show
							ID</button>
						<a class="reg-go text-[11px] text-[#008080] underline" href="#">Details</a>
					</div>
				</div>
			</div>
		</template>
	</main>

	<!-- Footer -->
	<div data-include="partials/footer.html"></div>

</body>

</html>
